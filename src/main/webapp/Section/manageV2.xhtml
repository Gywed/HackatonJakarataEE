<!DOCTYPE html>

<html xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:p="http://primefaces.org/ui" 
  xmlns:pt="http://xmlns.jcp.org/jsf/passthrough" xmlns:f = "http://java.sun.com/jsf/core">
<h:head>

<title>Sections</title>
<meta http-equiv="  Content-Type" content="text/html; charset=UTF-8"/>
</h:head>
<body>
	
	<div class="card">
	 	<h1>Liste des sections</h1>
	 	<p:commandButton value="Ajouter"  onclick="PF('createDialog').show()" />
	    <h:form>
	        <p:dataTable var="section" value="#{sectionControl.doFindAll()}" widgetVar="sections"
	                     emptyMessage="Aucune section n'a pu être trouvée avec les critères donnés"
	                     filteredValue="#{dtFilterView.sections}"
	                     globalFilterFunction="#{dtFilterView.globalFilterFunction}">
	
	            <f:facet name="header">
	                <div class="flex justify-content-end">
	                    <p:inputText id="globalFilter" onkeyup="PF('sections').filter()" style="width:300px"
	                                 placeholder="mots-clés..." />
	                </div>
	            </f:facet>
	
	            <p:column field="nom" headerText="Nom" sortBy="#{section.nom}" filterable="false" >
	                <h:outputText style="vertical-align: middle; margin-left: .5rem" value="#{section.nom}" />
	            </p:column>
	            
	            <p:column field="departement.nom" headerText="Département" filterable="false" sortBy="#{departementNameComparator}">
					<h:outputText style="vertical-align: middle; margin-left: .5rem" value="#{section.departement}" />
				</p:column>
	            
	            <p:column>
				    <f:facet name="header">Modifier</f:facet>
				    <p:commandButton value="Modifier" action="#{sectionControl.goToUpdateSection(section)}" onclick="PF('updateDialog').show()" />
				</p:column>
				
				<p:column>
					<f:facet name = "header">Supprimer</f:facet>
					
					<p:commandButton value = "Supprimer" action = "#{sectionControl.doDelete(section)}">
						<p:confirm header="Confirmation" message="Voulez-vous supprimer cette section ?" icon="pi pi-info-circle"/>
					</p:commandButton>
			      
			        <p:confirmDialog global="true" showEffect="fade" hideEffect="fade" responsive="true" width="350">
			        	<p:commandButton value="Non" type="button" styleClass="ui-confirmdialog-no ui-button-flat"/>
			            <p:commandButton value="Oui" type="button" styleClass="ui-confirmdialog-yes" />
			    	</p:confirmDialog>
			    	
				</p:column>
	
	        </p:dataTable>
	    </h:form>
	</div>

<!-- pop up modifier une section -->
	<p:dialog id="updateDialog" header="Modification" widgetVar="updateDialog" modal="true">
		<h:form id="updateForm">
	        <h:panelGrid columns="2" cellpadding="5">
	            <h:outputLabel for="nom" value="Nom :" />
	            <p:inputText id="nom" value="#{sectionControl.selectedSection.nom}" />
	            <p:selectOneMenu id="departement" value="#{sectionControl.departement}">     
	                <f:selectItems value="#{departementControl.doFindAll()}" var="departement"
	                              itemLabel="#{departement.nom}" itemValue="#{departement}" />
	            </p:selectOneMenu>
	        </h:panelGrid>
	        <p:commandButton value="Enregistrer" action="#{sectionControl.doUpdateSection()}" oncomplete="PF('updateDialog').hide()" />
	    </h:form>
	    
	</p:dialog>
	
	<!--  pop up ajouter une section -->
    <p:dialog id="createDialog" header="Ajouter une section" widgetVar="createDialog" modal="true">
	    <h:form id="createForm">
	        <h:panelGrid columns="2" cellpadding="5">
	        
	            <h:outputLabel for="nom" value="Nom :" />
	            <p:inputText id="nom" value="#{sectionControl.nom}" />
	            
	            <h:outputLabel for="departement" value="Departement :" />
				<p:selectOneMenu value="#{sectionControl.departement}">
					<f:selectItems value="#{departementControl.doFindAll()}" var="departement"/>
                </p:selectOneMenu>
	            
	        </h:panelGrid>
	        <p:commandButton value="Créer la section" action="#{sectionControl.doAdd()}" oncomplete="PF('createDialog').hide()" />
	    </h:form>
	</p:dialog>


    
</body>
</html>